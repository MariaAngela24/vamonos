{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}

<div class="row">
	<div class="col-xs-12 centered no-div">
		<!-- Main Content -->
		<h1><b><i>Â¡Vamonos!</i></b></h1>
		<h3>Plan your travel. Together.</h3>
	</div>
</div>

<div class="row">
	<div class="col-xs-12 centered" id="event-streams" data-cities="{{ citiesJSON }}" style="margin-top: 5em">
		<h3 class="no-div">Browse Cities</h3>
		{% for city in cities %}
			<div class="city-img" data-target="#modal-{{ city }}">
				<img src="/static/img/{{ city }}.jpg" data-city="{{ city }}" style="max-width: 100%">
			</div>

			<div id="{{ city }}-events-div" class="row city-events-div" style="display: none">
				<div class="col-xs-12">
					<table class="table">
						<thead>
							<th>Event</th>
							<th>Description</th>
						</thead>
						<tbody id="{{ city }}-events">
							<tr>
								<td>hello</td>
								<td>hello</td>
							</tr>
							<tr>
								<td>hello</td>
								<td>hello</td>
							</tr>
							<tr>
								<td>hello</td>
								<td>hello</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		{% endfor %}

	</div>
</div>

{% endblock %}



{% block scripts %}
<script>

// Functions
function getEvents() {

	// iterate thru cities
	var citiesJSON = $("#event-streams").data("cities");
	var cities = Object.keys(citiesJSON);

	cities.forEach(function (city) {
		var data = { "venue.city": city,
					 "token": "6OLY723AIVYNJBX63FFX",
					 "sort_by": "best",
					 "popular": 1
					};
		url = "https://www.eventbriteapi.com/v3/events/search/"

		// request events for that city
		$.get(url, data, function(result) {

			var events = result.events;

			events.forEach(function(event) {
				var eventHTML = '<tr>\
									<td>' + event.name.text + '</td>\
									<td>\
										<div style="height: 100px" class="scrollable">' + event.description.text + '</div>\
									</td>\
								</tr>';

				$("#" + city + "-events").append(eventHTML);
			})
		})
	});
}

function toggleEventsDiv(evt) {
	var city = evt.target.dataset.city;
	$('.city-events-div').hide('fast');
	// console.dir($('#' + city + '-events-div'));

	console.log($('#' + city + '-events-div'));
	if (true) {
		$('#' + city + '-events-div').toggle('fast');
	};
}

// Event listeners
// $(document).ready(getEvents);
$('.city-img').click(toggleEventsDiv);

</script>
{% endblock %}